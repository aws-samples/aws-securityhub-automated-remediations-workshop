# Overview
In this workshop you will learn how to implement automated remediations of findings submitted to [AWS Security Hub](https://aws.amazon.com/security-hub/) leveraging an open source tool named [Cloud Custodian](https://cloudcustodian.io/), with no prior knowledge of either required.

However, this workshop is not intended to to provide a complete introduction to writing polices for Cloud Custodian, for that please refer to the [Getting Started documentation](https://cloudcustodian.io/docs/aws/gettingstarted.html) or alternatively the [introductory presentation on Cloud Custodian](https://www.socallinuxexpo.org/sites/default/files/presentations/CloudCustodian%40Scale17x.pdf)

The automated remediations in this workshop are implemented as [AWS Lambda Functions](https://aws.amazon.com/lambda/) which get invoked by  [Cloudwatch Events](https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/WhatIsCloudWatchEvents.html). The [CloudWatch Events are generated by AWS Security Hub](https://docs.aws.amazon.com/en_pv/securityhub/latest/userguide/securityhub-cloudwatch-events.html#securityhub-cwe-configure) as a result of a Console user invoking a [Custom Action](https://docs.aws.amazon.com/en_pv/securityhub/latest/userguide/securityhub-cloudwatch-events.html#securityhub-cwe-send), or when a [finding is imported into Security Hub](https://docs.aws.amazon.com/en_pv/securityhub/latest/userguide/securityhub-findings.html).

Your feedback is highly desired, please [submit a new issue](https://github.com/aws-samples/aws-securityhub-automated-remediations-workshop/issues/new) if you run into any problems, even if you figure it out yourself, please report the problem so we can attempt to make this workshop as error proof as possible.

* **Level**: Intermediate
* **Duration**: 1 - 2 hours
* **[CSF Functions:](https://www.nist.gov/cyberframework/online-learning/five-functions)** Detect, Respond
* **[CAF Components:](https://d0.awsstatic.com/whitepapers/AWS_CAF_Security_Perspective.pdf")** Detective, Responsive
* **[Prerequisites:](https://awssecworkshops.com/getting-started/)** AWS Account with an Admin IAM user/role with [AWS CLI](https://aws.amazon.com/cli/) configured. If you are doing this Workshop as part of an AWS Event where Event Engine is being used, these will be supplied.

# Scenario

You are a Security Engineer who has just been tasked with automating some of the common steps that Security Analysts take when responding to insecure configuration, discovered vulnerabilities, or actual attacks.

# Architecture

For this Workshop you will view source files using Cloud 9 and invoke command lines via it's terminal window connected to an EC2 instance.
The automated remediations in this workshop will be deployed by using that terminal window to invoke Cloud Custodian running within a docker container.
Each module includes the execution of a Cloud Custodian policy, which is file written in a simple YAML based DSL which defines rules.
Most of the policies result in Cloud Custodian dynamically generating and deploying a Lambda Function, then deploying a CloudWatch Event rule with an event filter and a trigger to invoke the same Lambda function it just deployed.

The cloudformation in this workshop sets up the following:
1. AWS Cloud 9 Environment with associated ec2 instance.
2. IAM policies, Role, and Instance-Profiles.
3. An ec2 instance to be used as a test target.
4. IAM user to demo ability to disable it's access keys.
5. CloudWatch Log Groups

As part of the Workshop, Security Hub and Guard Duty will be enabled.

## Presentation deck
[Workshop Presentation Deck](./Security-Hub-Automated-Remediations-Workshop.pptx)

# Modules

This workshop is broken up into the following modules below:

1. [Environment Build and Configuration](./01-environment-setup.md)
2. [GuardDuty DNS Event on EC2 Instance](./02-guardduty-dns-event.md)
3. [Security Hub Custom Actions](./03-securityhub-custom-actions.md)
4. [Vulnerability Event on EC2 Instance with Very Risky Configuration](./04-ec2-instance-high-risk-config.md)
5. [GuardDuty Event on IAMUser](./05-guardduty-iam-user.md)
6. [Remediate an Public EBS-Snapshot](./06-ebs-snapshot-public.md)
7. [Cleanup of Resources -- not needed using an AWS Event provided account](./07-cleanup.md)
